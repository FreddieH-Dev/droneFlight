// ESP8266: Fixed Bridge - Forward Motor Commands Only
#include <ESP8266WiFi.h>
#include <espnow.h>

// Motor command packet (matches ESP32 sender)
struct Packet {
  uint8_t number;
  uint8_t frontLeft;
  uint8_t frontRight;
  uint8_t backLeft;
  uint8_t backRight;
};

Packet receivedData;
unsigned long lastPacketTime = 0;
unsigned long packetCount = 0;

void onDataRecv(uint8_t* mac, uint8_t* incomingData, uint8_t len) {
  if (len == sizeof(Packet)) {
    memcpy(&receivedData, incomingData, len);
    lastPacketTime = millis();
    packetCount++;
    
    // Immediately forward to UNO via Serial
    Serial.write('<');  // Start marker
    Serial.write((uint8_t*)&receivedData, sizeof(Packet));
    Serial.flush(); // Ensure immediate transmission
  }
}

void setup() {
  Serial.begin(250000);
  WiFi.mode(WIFI_STA);

  if (esp_now_init() != 0) {
    Serial.println("ESP-NOW init failed!");
    while (1);
  }

  esp_now_register_recv_cb(onDataRecv);
  Serial.println("âœ… Motor Bridge Ready");
}

void loop() {

}
